<!--based on http://bl.ocks.org/sumbera/c67e5551b21c68dc8299-->

<!doctype html>
<html>
<head>
    <title>Visualize Large GeoJSON points</title>
    <meta charset="utf-8">

    <style>
        html, body {
            height: 100%;
            padding: 0;
            margin: 0;
            background: rgb(14, 21, 30);
            height: 100%;
            font-family: Tahoma, Geneva, Verdana, sans-serif;
            font-size:12px;
            color:#808080;
        }

        #map {
            position: absolute;
            height: 100%;
            width: 100%;
            background-color: #333;
        }
    </style>
   

</head>
<body>
    <div id="map"></div>
    <div id="drop" style="position:absolute; right:0px; top:0px; width: 200px; height:50%;background-color: white;
                          border-style:dashed; border-color: blue; border-width:1px; border-radius:4px;padding:5px; opacity:0.9; z-index: 5000">
        <b>Drop GeoJSON here</b>
    </div>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.0-beta.2/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.0-beta.2/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.0.0/MarkerCluster.Default.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.0.0/MarkerCluster.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.0.0/leaflet.markercluster-src.js"></script>

    <script src="http://www.sumbera.com/gist/data/CZDistricts.js"></script> 


    <script>

        var leafletMap = L.map('map', {scrollWheelZoom : false}).setView([40, -74], 3);
        L.tileLayer("https://a.tile.openstreetmap.org/{z}/{x}/{y}.png")
            .addTo(leafletMap);
     
        var dropArea = document.getElementById('drop');

        dropArea.ondragover = function () {
            return false;
        };
        dropArea.ondragend = function () {
            return false;
        };
        dropArea.ondrop = function (e) {
            // -- helper from viz.js test of geojson-vt
            function humanFileSize(size) {
                var i = Math.floor(Math.log(size) / Math.log(1024));
                return Math.round(100 * (size / Math.pow(1024, i))) / 100 + ' ' + ['B', 'kB', 'MB', 'GB'][i];
            }
            var reader = new FileReader();
            
            reader.readAsText(e.dataTransfer.files[0]);
            dropArea.innerHTML += "<br/>";
            dropArea.innerHTML += "<br/>Loading... " + e.dataTransfer.files[0].name.toString();
            var start = new Date().getTime();
            reader.onload = function (event) {
                var elapsed = new Date().setTime(new Date().getTime() - start);
                dropArea.innerHTML += " " + elapsed + "ms";
                try {
                    dropArea.innerHTML += "<br/>&nbsp;Parsing... " + humanFileSize(event.target.result.length);
                    start = new Date().getTime();

                    var data;
                    data = JSON.parse(event.target.result);
                    elapsed = new Date().setTime(new Date().getTime() - start);
                    dropArea.innerHTML += " " + elapsed + "ms";

                    start = new Date().getTime();
                    dropArea.innerHTML += "<br/>&nbsp;Indexing... " + data.features.length + " features";
                    elapsed = new Date().setTime(new Date().getTime() - start);
                    dropArea.innerHTML += " " + elapsed + "ms";

                    var markers = L.markerClusterGroup({ disableClusteringAtZoom: 17 });
                    for(var i = 0; i < data.features.length; i++){
                        var marker = L.marker({lon : data.features[i].geometry.coordinates[0], lat : data.features[i].geometry.coordinates[1]});
                        marker.bindPopup('popup');
                        marker.bindPopup(Object.keys(data.features[i].properties).map(k => 
                            k + ': ' + data.features[i].properties[k]
                        ).join('<br/>'))
                        markers.addLayer(marker);
                    }
                    leafletMap.addLayer(markers)
                    leafletMap.fitBounds(markers.getBounds());


                } catch (err) {
                    dropArea.innerHTML += "<br/>&nbsp;Error: " + err;
                }
                

            };

            e.preventDefault();
            return false;
        };



    </script>
</body>
</html>